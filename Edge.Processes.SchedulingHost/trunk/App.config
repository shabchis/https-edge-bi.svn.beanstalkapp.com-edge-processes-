<?xml version="1.0"?>
<configuration>
	<configSections>
		<section name="TargetApplicationsConfiguration" type="SchedulersGuards.TargetApplicationsConfiguration,SchedulersGuards"/>
		<section name="log4net" type="log4net.Config.Log4NetConfigurationSectionHandler,log4net" />
	</configSections>
	<appSettings>
		<add key="Edge.Core.Services.Scheduling.Scheduler.Percentile" value="80"/>
		<add key="Edge.Core.Services.Scheduling.Scheduler.NeededScheduleTimeLine" value="02:00:00"/>
		<add key="Edge.Core.Services.Scheduling.Scheduler.IntervalBetweenNewSchedule" value="00:00:10"/>
		<add key="Edge.Core.Services.Scheduling.Scheduler.FindServicesToRunInterval" value="00:00:15"/>
		<add key="Edge.Core.Services.Scheduling.Scheduler.DeleteEndedServiceInterval" value="23:59:00"/>
		<add key="Edge.Core.Services.Scheduling.Scheduler.ISchedulingCommunication" value="net.pipe://localhost/"/>
		<add key="Edge.Core.Services.Scheduling.Scheduler.MaxExecutionTimeProduct" value="2.1"/>
		<add key="Edge.Core.Services.Scheduling.Scheduler.MaxExecutionTimeParentService" value="20"/>
		<add key="Edge.Core.Services.Scheduling.Scheduler.MaxExecutionTimeChildService" value="4"/>
		<add key="log4net.Internal.Debug" value="true"/>
	</appSettings>
	<connectionStrings>
		<add name="Edge.Core.Scheduling.Scheduler.OLTP" connectionString="Data Source=alonya-pc;Initial Catalog=testdb;Integrated Security=false;User ID=sa;PWD=Iuh2sstd"/>
		<add name="Edge.Core.Scheduling.Scheduler.System" connectionString="Data Source=alonya-pc;Initial Catalog=Edge_System291;Integrated Security=false;User ID=sa;PWD=Iuh2sstd"/>

	</connectionStrings>

	<system.serviceModel>
		<protocolMapping>
			<add scheme="http" binding="webHttpBinding"/>
		</protocolMapping>
		<services>
			<service name="Edge.Processes.SchedulingHost.SchedulingHost">
				<endpoint
					address="net.pipe://localhost/Scheduler"
					binding="netNamedPipeBinding"
					bindingConfiguration="Edge.Processes.SchedulingHost.SchedulingHost"
					contract="Edge.Core.Scheduling.ISchedulingHost"
				/>
			</service>
			<!--<service name="Edge.Core.Services.Scheduling.Scheduler" behaviorConfiguration="bla">
				<endpoint
					name="Edge.Core.Services.Scheduling.Scheduler"
					binding="webHttpBinding"
					bindingConfiguration="profiles"					
					contract="Edge.Core.Services.Scheduling.ISchedulerDataService"
					address="http://localhost:9000/"
				/>
			</service>-->
			<service name="Edge.Core.Services.ServiceExecutionHost" behaviorConfiguration="EdgeDefault">
				<endpoint
					name="Edge.Core.Services.ServiceExecutionHost"
					binding="netTcpBinding"
					bindingConfiguration="EdgeDefault"
					contract="Edge.Core.Services.IServiceExecutionHost"
					address="net.tcp://localhost:3535/{hostName}"
				/>
			</service>
			<service name="Edge.Core.Services.ServiceEnvironment" behaviorConfiguration="EdgeDefault">
				<endpoint
					name="Edge.Core.Services.ServiceEnvironment"
					binding="netTcpBinding"
					bindingConfiguration="EdgeDefault"
					contract="Edge.Core.Services.IServiceEnvironmentEventListener"
					address="net.tcp://localhost:3636/{guid}"
					
				/>
			</service>
		</services>
		<client>
			<endpoint
					name="Edge.Core.Services.ServiceExecutionHost"
					binding="netTcpBinding"
					bindingConfiguration="EdgeDefault"
					contract="Edge.Core.Services.IServiceExecutionHost"
				/>
			<endpoint
					name="Edge.Core.Services.ServiceEnvironment"
					binding="netTcpBinding"
					bindingConfiguration="EdgeDefault"
					contract="Edge.Core.Services.IServiceEnvironmentEventListener"
				/>
		</client>
		<behaviors>
			<serviceBehaviors>
				<behavior name="EdgeDefault">
					<serviceMetadata httpGetEnabled="false"/>
					<serviceDebug includeExceptionDetailInFaults="true"/>
					
				</behavior>
				<behavior name="bla">
					<serviceDebug includeExceptionDetailInFaults="true" httpsHelpPageUrl="true" />
					<dataContractSerializer maxItemsInObjectGraph="6553600"/>
					
				</behavior>
				<behavior name="behavior">
					<serviceMetadata httpGetEnabled="false"/>
					<serviceDebug includeExceptionDetailInFaults="true"/>
				</behavior>
			</serviceBehaviors>			
		</behaviors>
		<bindings>
			<netTcpBinding>
				<binding name="EdgeDefault"
						 portSharingEnabled="true"
						 maxBufferPoolSize="20000000"
						 maxConnections="20000000"
						 maxBufferSize="20000000"
						 maxReceivedMessageSize="20000000"						 
						 receiveTimeout="01:00:30"
						 sendTimeout="01:00:30"
						 closeTimeout="01:00:30"
						 openTimeout="01:00:30"
						 />
			</netTcpBinding>
			<webHttpBinding>
				<binding name="profiles"
						 maxBufferPoolSize="2147483647"
						 maxBufferSize="2147483647"
						 maxReceivedMessageSize="2147483647"
						 
						 receiveTimeout="01:00:30"
						 sendTimeout="01:00:30"
						 closeTimeout="01:00:30"
						 openTimeout="01:00:30">
					<readerQuotas maxArrayLength="2147483647"  maxStringContentLength="2147483647" maxDepth="32" maxNameTableCharCount="2147483647" maxBytesPerRead ="2147483647"/>
				</binding>
			</webHttpBinding>
			<basicHttpBinding>
				<binding name="BasicHttpBinding_IReportingService" closeTimeout="00:01:00" openTimeout="00:01:00" receiveTimeout="00:10:00" sendTimeout="00:01:00" allowCookies="false" bypassProxyOnLocal="false" hostNameComparisonMode="StrongWildcard" maxBufferSize="65536" maxBufferPoolSize="524288" maxReceivedMessageSize="65536" messageEncoding="Text" textEncoding="utf-8" transferMode="Buffered" useDefaultWebProxy="true">
					<readerQuotas maxDepth="32" maxStringContentLength="8192" maxArrayLength="16384" maxBytesPerRead="4096" maxNameTableCharCount="16384"/>
					<security mode="Transport">
						<transport clientCredentialType="None" proxyCredentialType="None" realm=""/>
						<message clientCredentialType="UserName" algorithmSuite="Default"/>
					</security>
				</binding>
			</basicHttpBinding>
			<netNamedPipeBinding>
				<binding name="Edge.Processes.SchedulingHost.SchedulingHost"  maxBufferPoolSize="20000000" maxConnections="20000000" maxBufferSize="20000000" maxReceivedMessageSize="20000000" closeTimeout="00:03:00" openTimeout="00:03:00" />
			</netNamedPipeBinding>
		</bindings>
	</system.serviceModel>
	<startup>
		<supportedRuntime version="v4.0" sku=".NETFramework,Version=v4.0"/>
	</startup>

	<log4net debug="true">
		<appender name="RollingLogFileAppender" type="log4net.Appender.RollingFileAppender">
			<file value="/log4net.txt" />
			<appendToFile value="true" />
			<rollingStyle value="Size" />
			<maxSizeRollBackups value="10" />
			<maximumFileSize value="10MB" />
			<staticLogFileName value="true" />
			<layout type="log4net.Layout.PatternLayout">
				<conversionPattern value="%-5p %d %5rms %-22.22c{1} %-18.18M - %m%n" />
			</layout>
		</appender>
		<appender name="AdoNetAppender" type="log4net.Appender.AdoNetAppender">
			<bufferSize value="1" />
			<connectionType value="System.Data.SqlClient.SqlConnection, System.Data, Version=1.0.3300.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" />
			Data Source=alonya-pc;Initial Catalog=Edge_System;Integrated Security=false;User ID=sa;PWD=Iuh2sstd
			<connectionString value="data source=alonya-pc;initial catalog=Edge_System291;integrated security=false;persist security info=True;User ID=sa;Password=Iuh2sstd" />
			<commandText value="INSERT INTO Log ([DateRecorded],[MachineName],[ProcessID],[Source],[MessageType],[ServiceInstanceID],[AccountID],[Message],[IsException],[ExceptionDetails]) &#xD;&#xA;           VALUES (@dateRecorded, @machineName, @processID, @source, @messageType, @serviceInstanceID,@accountID,@message,@isException,@exceptionDetails)"
                                                                                                                                                           />
			<parameter>
				<parameterName value="@dateRecorded" />
				<dbType value="DateTime" />
				<layout type="log4net.Layout.RawTimeStampLayout">
					<conversionPattern value="%property{@dateRecorded}" />
				</layout>
			</parameter>
			<parameter>
				<parameterName value="@machineName" />
				<dbType value="String" />
				<size value="255" />
				<layout type="log4net.Layout.PatternLayout">
					<conversionPattern value="%property{@machineName}" />
				</layout>
			</parameter>
			<parameter>
				<parameterName value="@processID" />
				<dbType value="Int32" />
				<size value="8" />
				<layout type="log4net.Layout.PatternLayout">
					<conversionPattern value="%property{@processID}" />
				</layout>
			</parameter>
			<parameter>
				<parameterName value="@source" />
				<dbType value="String" />
				<size value="255" />
				<layout type="log4net.Layout.PatternLayout">
					<conversionPattern value="%property{@source}" />
				</layout>
			</parameter>
			<parameter>
				<parameterName value="@messageType" />
				<dbType value="Int32" />
				<size value="8" />
				<layout type="log4net.Layout.PatternLayout">
					<conversionPattern value="%property{@messageType}" />
				</layout>
			</parameter>
			<parameter>
				<parameterName value="@serviceInstanceID" />
				<dbType value="Int64" />
				<size value="10" />
				<layout type="log4net.Layout.PatternLayout">
					<conversionPattern value="%property{@serviceInstanceID}" />
				</layout>
			</parameter>
			<parameter>
				<parameterName value="@accountID" />
				<dbType value="Int32" />
				<size value="8" />
				<layout type="log4net.Layout.PatternLayout">
					<conversionPattern value="%property{@accountID}" />
				</layout>
			</parameter>
			<parameter>
				<parameterName value="@message" />
				<dbType value="String" />
				<size value="4000" />
				<layout type="log4net.Layout.PatternLayout">
					<conversionPattern value="%property{@message}" />
				</layout>
			</parameter>
			<parameter>
				<parameterName value="@isException" />
				<dbType value="Boolean" />
				<size value="1" />
				<layout type="log4net.Layout.PatternLayout">
					<conversionPattern value="%property{@isException}" />
				</layout>
			</parameter>
			<parameter>
				<parameterName value="@exceptionDetails" />
				<dbType value="String" />
				<size value="4000" />
				<layout type="log4net.Layout.PatternLayout">
					<conversionPattern value="%property{@exceptionDetails}" />
				</layout>
			</parameter>
		</appender>
		<appender name="SmtpAppender" type="log4net.Appender.SmtpAppender">
			<to value="alon.yaari@edge.bi" />
			<from value="alon.yaari@edge.bi" />
			<subject value="Hello from log4net" />
			<smtpHost value="mx.edge.bi" />
			<bufferSize value="512" />
			<lossy value="true" />
			<evaluator type="log4net.Core.LevelEvaluator">
				<threshold value="WARN"/>
			</evaluator>
			<layout type="log4net.Layout.PatternLayout">
				<conversionPattern value="%newline%date [%thread] %-5level %logger [%property{NDC}] - %message%newline%newline%newline" />
			</layout>
		</appender>

		<root>
			<level value="DEBUG" />
			<!--<appender-ref ref="RollingLogFileAppender" />-->
			<appender-ref ref="AdoNetAppender" />
			<!--<appender-ref ref="SmtpAppender" />-->
		</root>
	</log4net>
	<system.diagnostics>
		<sources>
			<source name="System.ServiceModel"
					switchValue="Information, ActivityTracing"
					propagateActivity="true" >
				<listeners>
					<add name="xml"/>
				</listeners>
			</source>
			<source name="System.ServiceModel.MessageLogging">
				<listeners>
					<add name="xml"/>
				</listeners>
			</source>
			<source name="myUserTraceSource"
					switchValue="Information, ActivityTracing">
				<listeners>
					<add name="xml"/>
				</listeners>
			</source>
		</sources>
		<sharedListeners>
			<add name="xml"
				 type="System.Diagnostics.XmlWriterTraceListener"
					   initializeData="Traces.svclog" />
		</sharedListeners>
	</system.diagnostics>

	<system.serviceModel>
		<diagnostics wmiProviderEnabled="true">
			<messageLogging
				 logEntireMessage="true"
				 logMalformedMessages="true"
				 logMessagesAtServiceLevel="true"
				 logMessagesAtTransportLevel="true"
				 maxMessagesToLog="9999999"
				 maxSizeOfMessageToLog="999999999"
       />
		</diagnostics>
	</system.serviceModel>
</configuration>
